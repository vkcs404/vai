<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <title>Admin - Gerenciar Clientes - Vai</title>
</head>
<body>
    <div>
        <nav>
            <a href="/">Home</a>
            <a href="/admin/dashboard">Dashboard Admin</a>
            <a href="{{ url_for('main.admin_logout') }}">Sair</a>
        </nav>
    </div>

    <div class="scanner-container">
        <h1>Painel do Administrador</h1>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div style="background: {% if category == 'success' %}rgba(16, 185, 129, 0.2){% elif category == 'danger' %}rgba(255, 0, 64, 0.2){% else %}rgba(0, 212, 255, 0.2){% endif %}; border: 2px solid {% if category == 'success' %}#10b981{% elif category == 'danger' %}#ff0040{% else %}#00d4ff{% endif %}; border-radius: 10px; padding: 1rem; margin-bottom: 1.5rem; color: #ffffff;">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="scanner-form-card">
            <h3>Gerenciar Clientes</h3>
            
            {% if clientes %}
            <div class="admin-table-container">
                
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Nível de Acesso</th>
                            <th style="text-align: center;">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cliente in clientes %}
                        <tr>
                            <td>{{ cliente.id }}</td>
                            <td>{{ cliente.cliente_nome }}</td>
                            <td>{{ cliente.cliente_email }}</td>
                            <td>
                                <span style="display: inline-block; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600; 
                                    {% if cliente.cliente_status == 'ativo' %}
                                        background: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid #10b981;
                                    {% else %}
                                        background: rgba(255, 0, 64, 0.2); color: #ff0040; border: 1px solid #ff0040;
                                    {% endif %}">
                                    {{ cliente.cliente_status|capitalize }}
                                </span>
                            </td>
                            <td>
                                <form action="{{ url_for('main.alterar_nivel_acesso', cliente_id=cliente.id) }}" method="POST" style="display: flex; gap: 0.5rem; align-items: center;">
                                    <select name="novo_nivel" required class="form-control" style="padding: 0.5rem; font-size: 0.9rem; width: auto;">
                                        <option value="basico" {% if cliente.nivel_acesso == 'basico' %}selected{% endif %}>Básico</option>
                                        <option value="intermediario" {% if cliente.nivel_acesso == 'intermediario' %}selected{% endif %}>Intermediário</option>
                                        <option value="avancado" {% if cliente.nivel_acesso == 'avancado' %}selected{% endif %}>Avançado</option>
                                    </select>
                                    <button type="submit" class="btn-submit" style="width: auto; padding: 0.5rem 1rem; font-size: 0.85rem; margin-top: 0;">
                                        Alterar
                                    </button>
                                </form>
                            </td>
                            <td style="text-align: center;">
                                <form action="{{ url_for('main.alternar_status', cliente_id=cliente.id) }}" method="POST" style="display: inline;">
                                    <button type="submit" class="btn-submit" style="width: auto; padding: 0.5rem 1rem; font-size: 0.85rem; margin-top: 0;
                                        {% if cliente.cliente_status == 'ativo' %}
                                            background: rgba(255, 0, 64, 0.2); border: 2px solid #ff0040; color: #ff0040;
                                        {% else %}
                                            background: rgba(16, 185, 129, 0.2); border: 2px solid #10b981; color: #10b981;
                                        {% endif %}">
                                        {% if cliente.cliente_status == 'ativo' %}
                                            Desativar
                                        {% else %}
                                            Ativar
                                        {% endif %}
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
                <div style="text-align: center; padding: 3rem; color: #b0b0b0;">
                    <p style="font-size: 1.1rem;">Nenhum cliente cadastrado no sistema.</p>
                </div>
            {% endif %}
        </div>

        <div class="relatorio-info-card">
            <h2>Estatísticas do Sistema</h2>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Total de Clientes:</span>
                    <span class="info-value">{{ clientes|length }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Clientes Ativos:</span>
                    <span class="info-value">{{ clientes|selectattr('cliente_status', 'equalto', 'ativo')|list|length }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Clientes Inativos:</span>
                    <span class="info-value">{{ clientes|selectattr('cliente_status', 'equalto', 'inativo')|list|length }}</span>
                </div>
            </div>
        </div>
    </div>
</body>
</html>